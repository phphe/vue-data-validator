/*!
 * vue-data-validator v2.2.0
 * phphe <phphe@outlook.com> (https://github.com/phphe)
 * https://github.com/phphe/vue-data-validator.git
 * Released under the MIT License.
 */

!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e.vueDataValidatorValidator=e.vueDataValidatorValidator||{},e.vueDataValidatorValidator.js=r())}(this,function(){"use strict";function e(e){return void 0!==e}function r(e){return"[object Boolean]"===Object.prototype.toString.call(e)}function t(e){return"[object Number]"===Object.prototype.toString.call(e)}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function a(e){return"function"==typeof e}function n(e){return"[object Promise]"===Object.prototype.toString.call(e)}function s(e){return null==e||(null!=e.length?0===e.length:!r(e)&&(t(e)?isNaN(e):i(e)?0===Object.keys(e).length:void 0))}function l(e,r){var t={};for(var i in e)t[i]=r(e[i],i,e);return t}function o(e){return e.nameInMessage||e.text&&e.text.toString().toLowerCase()||e.name||"unnamed"}function u(e,r,t){var i=r.nameInMessage,n=a(e.message)?e.message({value:r.value,params:e.params,field:r,fields:t.fields,validation:t,Vue:Vue}):e.message;n=n.replace(/:name/g,i).replace(/:value/g,r.value);for(var s in e.params){var l=new RegExp(":params\\["+s+"\\]","g");n=n.replace(l,e.params[s])}var u=n.match(/:fieldName\(.+?\)/g);if(u){var d=!0,v=!1,c=void 0;try{for(var f,h=u[Symbol.iterator]();!(d=(f=h.next()).done);d=!0){var m=f.value,g=m.match(/\((.+)\)/)[1],p=t.fields[g];p||console.warn("vue-data-validator: error when generate error message. Can't found field "+g+". Current field is "+r.name+".");var y=p?o(p):"";n=n.replace(m,y)}}catch(e){v=!0,c=e}finally{try{!d&&h.return&&h.return()}finally{if(v)throw c}}}return n}return{rules:{},messages:{},validClass:"has-success",invalidClass:"has-error",validtingClass:"",install:function(e){e.validator=e.prototype.$validator=this,e.prototype.$validate=function(r,t){return e.validator.validate(r,t,this)}},validate:function(e,r,t){var i=this;return e.clear&&e.clear(),this.initValidation(e,r,t),this.initFields(e,t),Object.values(r).forEach(function(r){return i.validateField(r,e)}),e},initValidation:function(e,r,t){var i={fields:r,dirty:!1,valid:!1,validating:!1,isPause:!1,_sensitiveFields:[],vm:t,isSubmitAble:function(){return this.valid&&!this.validating},getValues:function(){return l(this.fields,function(e){return e.value})},setValues:function(e){for(var r in e)this.fields.hasOwnProperty(r)&&(this.fields[r].value=e[r]);return this},setDirty:function(e){return this.dirty=e,Object.values(this.fields).forEach(function(r){r.dirty=e}),this},check:function(){var e=this;return new Promise(function(r,t){e.validating?t(new Error("validating")):e.valid?r(e.getValues()):(e.setDirty(!0),t(new Error("invalid")))})},unwatch:function(){return Object.values(this.fields).forEach(function(e){e.watcher&&e.watcher.unwatch&&e.watcher.unwatch()}),this},pause:function(){return this.isPause=!0,this},continue:function(){return this.isPause=!1,this},clear:function(){return this.unwatch(),this.setDirty(!1),Object.values(this.fields).forEach(function(e){e.required=!1}),this},revalidate:function(){return t.$validate(this,this.fields)},getFirstError:function(){var e=Object.values(this.fields).find(function(e){return Object.values(e.errors)[0]});return e&&Object.values(e.errors)[0]},getErrors:function(){var e=[];return Object.values(this.fields).forEach(function(r){Object.values(r.errors).forEach(function(r){e.push(r)})}),e}};for(var a in i)t.$set(e,a,i[a])},initFields:function(r,t){var i=this;for(var a in r.fields)!function(a){var n=r.fields[a];if(n.name){if(n.name!==a)throw Error("The field name must be same with its key.")}else t.$set(n,"name",a);n.nameInMessage||(n.nameInMessage=o(n)),t.$set(n,"value",e(n.value)?n.value:null),t.$set(n,"dirty",!1),t.$set(n,"valid",!1),t.$set(n,"errors",{}),t.$set(n,"required",!1),t.$set(n,"validating",!1),t.$set(n,"_resolvedRules",i.resolveRules(n)),t.$set(n,"isValidationErrorsVisible",function(){return n.rules&&!n.validating&&n.dirty&&!n.valid}),t.$set(n,"getValidationClass",function(){return n.rules&&n.dirty?n.validating?i.validatingClass:n.valid?i.validClass:i.invalidClass:null}),Object.values(n._resolvedRules).find(function(e){return e.sensitive})&&r._sensitiveFields.push(n);var s={getValue:function(){return n.value},handler:function(e){r.isPause||(n._ignoreDirtyOnce?n._ignoreDirtyOnce=!1:(n.dirty=!0,r.dirty=!0),i.validateField(n,r),r._sensitiveFields.filter(function(e){return e!==n}).forEach(function(e){i.validateField(e,r)}))}};s.unwatch=t.$watch(s.getValue,s.handler),t.$set(n,"watcher",s)}(a)},resolveRules:function(e){var r={};if(e.rules){var t=e.rules.split("|");for(var i in t){var n=t[i].split(":"),s=n[1]?n[1].split(","):[],l=n[0];e.ruleParams&&e.ruleParams[l]&&(s=s.concat(e.ruleParams[l]));var o=e.customRules&&e.customRules[l]||this.rules[l];if(a(o)&&(o={handler:o}),null==o)throw Error("Rule '"+l+"' of field '"+e.name+"' is not found.");r[l]={name:l,params:s,required:o.required,sensitive:o.sensitive,handler:o.handler,message:e.messages&&e.messages[l]||this.messages&&this.messages[l]||"No error message for :name."}}}return r},validateField:function(e,r){var t=this,i={};e._validationId=i,r.validating=!0,e.validating=!0,this.removeFieldAllErrors(e,r);var a=Object.values(e._resolvedRules),n=Promise.resolve(!0),s=!0,l=!1,o=void 0;try{for(var u,d=a[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var v=u.value;!function(a){n=n.then(function(){return t.validateRule(a,e,r,i)})}(v)}}catch(e){l=!0,o=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw o}}n.then(function(){return!0}).catch(function(e){return"expired"!==e.message}).then(function(t){t&&(e._validationId=null,e.validating=!1,r.validating=Object.values(r.fields).some(function(e){return e.validating}))})},validateRule:function(e,r,t,i){var l=this;return null!=e.required&&(r.required=a(e.required)?e.required({value:r.value,params:e.params,field:r,fields:t.fields,validation:t,Vue:t.vm.$root.constructor}):e.required),new Promise(function(a,o){if(r.required||!s(r.value)){var u=e.handler({value:r.value,params:e.params,field:r,fields:t.fields,validation:t,Vue:t.vm.$root.constructor});n(u)||(u=u?Promise.resolve():Promise.reject(new Error("invalid"))),u.then(function(){i!==r._validationId&&o(new Error("expired")),l.removeFieldError(e,r,t),a()}).catch(function(a){i!==r._validationId&&o(new Error("expired")),l.addFieldError(e,r,t),o(a)})}else a()})},addFieldError:function(e,r,t){var i=u(e,r,t);if(!r.errors[e.name]){var a={};for(var n in r._resolvedRules)r.errors[n]?a[n]=r.errors[n]:n===e.name&&(a[n]={});r.errors=a}r.errors[e.name]={name:e.name,message:i,field:r},r.valid=!1,t.valid=!1},removeFieldError:function(e,r,t){var i={};for(var a in r.errors)a!==e.name&&(i[a]=r.errors[a]);r.errors=i,r.valid=0===Object.keys(r.errors).length,t.valid=Object.values(t.fields).every(function(e){return e.valid})},removeFieldAllErrors:function(e,r){e.errors={},e.valid=!0,r.valid=Object.values(r.fields).every(function(e){return e.valid})}}});
//# sourceMappingURL=validator.min.js.map