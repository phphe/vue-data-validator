/*!
 * vue-data-validator v2.2.5
 * phphe <phphe@outlook.com> (https://github.com/phphe)
 * https://github.com/phphe/vue-data-validator.git
 * Released under the MIT License.
 */

!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e.vueDataValidatorValidator=e.vueDataValidatorValidator||{},e.vueDataValidatorValidator.js=r())}(this,function(){"use strict";function e(e){return void 0!==e}function r(e){return"[object Boolean]"===Object.prototype.toString.call(e)}function t(e){return"[object Number]"===Object.prototype.toString.call(e)}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(e){return"function"==typeof e}function a(e){return"[object Promise]"===Object.prototype.toString.call(e)}function s(e){return null==e||(null!=e.length?0===e.length:!r(e)&&(t(e)?isNaN(e):i(e)?0===Object.keys(e).length:void 0))}function l(e,r){var t={};for(var i in e)t[i]=r(e[i],i,e);return t}function o(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function i(n,a){try{var s=r[n](a),l=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(l).then(function(e){i("next",e)},function(e){i("throw",e)});e(l)}return i("next")})}}function u(e){return e.nameInMessage||e.text&&e.text.toString().toLowerCase()||e.name||"unnamed"}function c(e,r,t){var i=r.nameInMessage,a=n(e.message)?e.message({value:r.value,params:e.params,field:r,fields:t.fields,validation:t,Vue:Vue}):e.message;a=a.replace(/:name/g,i).replace(/:value/g,r.value);for(var s in e.params){var l=new RegExp(":params\\["+s+"\\]","g");a=a.replace(l,e.params[s])}var o=a.match(/:fieldName\(.+?\)/g);if(o){var c=!0,d=!1,v=void 0;try{for(var f,h=o[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var m=f.value,g=m.match(/\((.+)\)/)[1],p=t.fields[g];p||console.warn("vue-data-validator: error when generate error message. Can't found field "+g+". Current field is "+r.name+".");var y=p?u(p):"";a=a.replace(m,y)}}catch(e){d=!0,v=e}finally{try{!c&&h.return&&h.return()}finally{if(d)throw v}}}return a}return{rules:{},messages:{},validClass:"has-success",invalidClass:"has-error",validtingClass:"",install:function(e){e.validator=e.prototype.$validator=this,e.prototype.$validate=function(r,t){return e.validator.validate(r,t,this)}},validate:function(e,r,t){var i=this;return e.clear&&e.clear(),this.initValidation(e,r,t),this.initFields(e,t),Object.values(r).forEach(function(r){return i.validateField(r,e)}),e},initValidation:function(e,r,t){var i={fields:r,dirty:!1,valid:!1,validating:!1,isPause:!1,_sensitiveFields:[],vm:t,isSubmitAble:function(){return this.valid&&!this.validating},getValues:function(){return l(this.fields,function(e){return e.value})},setValues:function(e){for(var r in e)this.fields.hasOwnProperty(r)&&(this.fields[r].value=e[r]);return this},setDirty:function(e){return this.dirty=e,Object.values(this.fields).forEach(function(r){r.dirty=e}),this},check:function(){var e=this;return new Promise(function(){var r=o(regeneratorRuntime.mark(function r(t,i){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.validating){r.next=5;break}return e._checkResolves||(e._checkResolves=[]),n=new Promise(function(r,t){e._checkResolves.push(r)}),r.next=5,n;case 5:e.valid?t(e.getValues()):(e.setDirty(!0),i(new Error("invalid")));case 6:case"end":return r.stop()}},r,e)}));return function(e,t){return r.apply(this,arguments)}}())},unwatch:function(){return Object.values(this.fields).forEach(function(e){e.watcher&&e.watcher.unwatch&&e.watcher.unwatch()}),this},pause:function(){return this.isPause=!0,this},continue:function(){return this.isPause=!1,this},clear:function(){return this.unwatch(),this.setDirty(!1),Object.values(this.fields).forEach(function(e){e.required=!1}),this},revalidate:function(){return t.$validate(this,this.fields)},getFirstError:function(){var e=Object.values(this.fields).find(function(e){return Object.values(e.errors)[0]});return e&&Object.values(e.errors)[0]},getErrors:function(){var e=[];return Object.values(this.fields).forEach(function(r){Object.values(r.errors).forEach(function(r){e.push(r)})}),e}};for(var n in i)t.$set(e,n,i[n])},initFields:function(r,t){var i=this;for(var n in r.fields)!function(n){var a=r.fields[n];if(a.name){if(a.name!==n)throw Error("The field name must be same with its key.")}else t.$set(a,"name",n);a.nameInMessage||(a.nameInMessage=u(a)),t.$set(a,"value",e(a.value)?a.value:null),t.$set(a,"dirty",!1),t.$set(a,"valid",!1),t.$set(a,"errors",{}),t.$set(a,"required",!1),t.$set(a,"validating",!1),t.$set(a,"_resolvedRules",i.resolveRules(a)),t.$set(a,"isValidationErrorsVisible",function(){return a.rules&&!a.validating&&a.dirty&&!a.valid}),t.$set(a,"getValidationClass",function(){return a.rules&&a.dirty?a.validating?i.validatingClass:a.valid?i.validClass:i.invalidClass:null}),Object.values(a._resolvedRules).find(function(e){return e.sensitive})&&r._sensitiveFields.push(a);var s={getValue:function(){return a.value},handler:function(e){r.isPause||(a._ignoreDirtyOnce?a._ignoreDirtyOnce=!1:(a.dirty=!0,r.dirty=!0),i.validateField(a,r),r._sensitiveFields.filter(function(e){return e!==a}).forEach(function(e){i.validateField(e,r)}))}};s.unwatch=t.$watch(s.getValue,s.handler,{deep:a.deep}),t.$set(a,"watcher",s)}(n)},resolveRules:function(e){var r={};if(e.rules){var t=e.rules.split("|");for(var i in t){var a=t[i].split(":"),s=a[1]?a[1].split(","):[],l=a[0];e.ruleParams&&e.ruleParams[l]&&(s=s.concat(e.ruleParams[l]));var o=e.customRules&&e.customRules[l]||this.rules[l];if(n(o)&&(o={handler:o}),null==o)throw Error("Rule '"+l+"' of field '"+e.name+"' is not found.");r[l]={name:l,params:s,required:o.required,sensitive:o.sensitive,handler:o.handler,message:e.messages&&e.messages[l]||this.messages&&this.messages[l]||"No error message for :name."}}}return r},validateField:function(e,r){var t=this,i={};e._validationId=i,r.validating=!0,e.validating=!0,this.removeFieldAllErrors(e,r);var n=Object.values(e._resolvedRules),a=Promise.resolve(!0),s=!0,l=!1,o=void 0;try{for(var u,c=n[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var d=u.value;!function(n){a=a.then(function(){return t.validateRule(n,e,r,i)})}(d)}}catch(e){l=!0,o=e}finally{try{!s&&c.return&&c.return()}finally{if(l)throw o}}a.then(function(){return!0}).catch(function(e){return"expired"!==e.message}).then(function(t){t&&(e._validationId=null,e.validating=!1,r.validating=Object.values(r.fields).some(function(e){return e.validating}),r.validating||r._checkResolves&&(r._checkResolves.forEach(function(e){e()}),r._checkResolves=null))})},validateRule:function(e,r,t,i){var l=this;return null!=e.required&&(r.required=n(e.required)?e.required({value:r.value,params:e.params,field:r,fields:t.fields,validation:t,Vue:t.vm.$root.constructor}):e.required),new Promise(function(n,o){if(r.required||!s(r.value)){var u=e.handler({value:r.value,params:e.params,field:r,fields:t.fields,validation:t,Vue:t.vm.$root.constructor});a(u)||(u=u?Promise.resolve():Promise.reject(new Error("invalid"))),u.then(function(){i!==r._validationId&&o(new Error("expired")),l.removeFieldError(e,r,t),n()}).catch(function(n){i!==r._validationId&&o(new Error("expired")),l.addFieldError(e,r,t),o(n)})}else n()})},addFieldError:function(e,r,t){var i=c(e,r,t);if(!r.errors[e.name]){var n={};for(var a in r._resolvedRules)r.errors[a]?n[a]=r.errors[a]:a===e.name&&(n[a]={});r.errors=n}r.errors[e.name]={name:e.name,message:i,field:r},r.valid=!1,t.valid=!1},removeFieldError:function(e,r,t){var i={};for(var n in r.errors)n!==e.name&&(i[n]=r.errors[n]);r.errors=i,r.valid=0===Object.keys(r.errors).length,t.valid=Object.values(t.fields).every(function(e){return e.valid})},removeFieldAllErrors:function(e,r){e.errors={},e.valid=!0,r.valid=Object.values(r.fields).every(function(e){return e.valid})}}});
//# sourceMappingURL=validator.min.js.map