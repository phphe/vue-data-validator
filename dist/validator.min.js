/*!
 * vue-data-validator v2.2.12
 * (c) 2017-present phphe <phphe@outlook.com> (https://github.com/phphe)
 * Released under the MIT License.
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.vueDataValidator=r()}(this,function(){"use strict";function e(e){return"function"==typeof e}function r(e){return null==e||(null!=e.length?0===e.length:!function(e){return"[object Boolean]"===Object.prototype.toString.call(e)}(e)&&(function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)?isNaN(e):function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e)?0===Object.keys(e).length:void 0))}function t(e){return{storage:e,set:function(e,r,t){null==r?this.storage.removeItem(e):this.storage.setItem(e,JSON.stringify({value:r,expired_at:t&&(new Date).getTime()/1e3+60*t}))},get:function(e){var r=this.storage.getItem(e);if(r){if(!(r=JSON.parse(r)).expired_at||r.expired_at>(new Date).getTime())return r.value;this.storage.removeItem(e)}return null},clear:function(){this.storage.clear()}}}t(window.localStorage),t(window.sessionStorage);function i(e){return e.nameInMessage||e.text&&e.text.toString().toLowerCase()||e.name||"unnamed"}return{rules:{},messages:{},validClass:"has-success",invalidClass:"has-error",validtingClass:"",install:function(e){this.Vue=e,e.validator=e.prototype.$validator=this,e.prototype.$validate=function(r,t){return e.validator.validate(r,t,this)}},validate:function(e,r,t){var i=this;return e.clear&&e.clear(),this.initValidation(e,r,t),this.initFields(e,t),Object.values(r).forEach(function(r){return i.validateField(r,e)}),e},initValidation:function(e,r,t){var i={Vue:this.Vue,fields:r,dirty:!1,valid:!1,validating:!1,isPause:!1,_sensitiveFields:[],vm:t,isSubmitAble:function(){return this.valid&&!this.validating},getValues:function(){return function(e,r){var t={};for(var i in e)t[i]=r(e[i],i,e);return t}(this.fields,function(e){return e.value})},setValues:function(e){for(var r in e)this.fields.hasOwnProperty(r)&&(this.fields[r].value=e[r]);return this},setDirty:function(e){return this.dirty=e,Object.values(this.fields).forEach(function(r){r.dirty=e}),this},check:function(){var e=this;return new Promise(function(r,t){return e.validating&&(e._checkResolves||(e._checkResolves=[])),(e.validating?new Promise(function(r,t){e._checkResolves.push(r)}):Promise.resolve()).then(function(){e.valid?r(e.getValues()):(e.setDirty(!0),t(new Error("invalid")))})})},unwatch:function(){return Object.values(this.fields).forEach(function(e){e.watcher&&e.watcher.unwatch&&e.watcher.unwatch()}),this},pause:function(){return this.isPause=!0,this},continue:function(){return this.isPause=!1,this},clear:function(){return this.unwatch(),this.setDirty(!1),Object.values(this.fields).forEach(function(e){e.required=!1}),this},revalidate:function(){return t.$validate(this,this.fields)},getFirstError:function(){var e=Object.values(this.fields).find(function(e){return Object.values(e.errors)[0]});return e&&Object.values(e.errors)[0]},getErrors:function(){var e=[];return Object.values(this.fields).forEach(function(r){Object.values(r.errors).forEach(function(r){e.push(r)})}),e}};for(var n in i)t.$set(e,n,i[n])},initFields:function(e,r){var t=this,n=function(n){var a=e.fields[n];if(a.name){if(a.name!==n)throw Error("The field name must be same with its key.")}else r.$set(a,"name",n);a.nameInMessage||(a.nameInMessage=i(a)),r.$set(a,"value",void 0!==a.value?a.value:null),r.$set(a,"dirty",!1),r.$set(a,"valid",!1),r.$set(a,"errors",{}),r.$set(a,"required",!1),r.$set(a,"validating",!1),r.$set(a,"_resolvedRules",t.resolveRules(a)),r.$set(a,"isValidationErrorsVisible",function(e){e||(e=[a]);var r=!0,t=!1,i=void 0;try{for(var n,s=e[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var l=n.value;if(l.rules&&l.dirty&&!a.validating&&!a.valid)return!0}}catch(e){t=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(t)throw i}}return!1}),r.$set(a,"getValidationClass",function(e){var r;e||(e=[a]);var i=!0,n=!1,s=void 0;try{for(var l,o=e[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=l.value;if(u.rules&&u.dirty){if(r=!0,a.validating)return t.validatingClass;if(!a.valid)return t.invalidClass}}}catch(e){n=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(n)throw s}}return r?t.validClass:null}),Object.values(a._resolvedRules).find(function(e){return e.sensitive})&&e._sensitiveFields.push(a);var s={getValue:function(){return a.value},handler:function(r){e.isPause||(a._ignoreDirtyOnce?a._ignoreDirtyOnce=!1:(a.dirty=!0,e.dirty=!0),t.validateField(a,e),e._sensitiveFields.filter(function(e){return e!==a}).forEach(function(r){t.validateField(r,e)}))}};s.unwatch=r.$watch(s.getValue,s.handler,{deep:a.deep}),r.$set(a,"watcher",s)};for(var a in e.fields)n(a)},resolveRules:function(r){var t={};if(r.rules){var i=r.rules.split("|");for(var n in i){var a=i[n].split(":"),s=a[1]?a[1].split(","):[],l=a[0];r.ruleParams&&r.ruleParams[l]&&(s=s.concat(r.ruleParams[l]));var o=r.customRules&&r.customRules[l]||this.rules[l];if(e(o)&&(o={handler:o}),null==o)throw Error("Rule '".concat(l,"' of field '").concat(r.name,"' is not found."));t[l]={name:l,params:s,required:o.required,sensitive:o.sensitive,handler:o.handler,message:r.messages&&r.messages[l]||this.messages&&this.messages[l]||"No error message for :name."}}}return t},validateField:function(e,r){var t=this,i={};e._validationId=i,r.validating=!0,e.validating=!0,this.removeFieldAllErrors(e,r);for(var n=Object.values(e._resolvedRules),a=Promise.resolve(!0),s=function(){var s=n[l];a=a.then(function(){return t.validateRule(s,e,r,i)})},l=0;l<n.length;l++)s();a.then(function(){return!0}).catch(function(e){return"expired"!==e.message}).then(function(t){t&&(e._validationId=null,e.validating=!1,r.validating=Object.values(r.fields).some(function(e){return e.validating}),r.validating||r._checkResolves&&(r._checkResolves.forEach(function(e){e()}),r._checkResolves=null))})},validateRule:function(t,i,n,a){var s=this;return null!=t.required&&(i.required=e(t.required)?t.required({value:i.value,params:t.params,field:i,fields:n.fields,validation:n,Vue:n.Vue}):t.required),new Promise(function(e,l){if(i.required||!r(i.value)){var o=t.handler({value:i.value,params:t.params,field:i,fields:n.fields,validation:n,Vue:n.Vue});u=o,"[object Promise]"!==Object.prototype.toString.call(u)&&(o=o?Promise.resolve():Promise.reject(new Error("invalid"))),o.then(function(){a!==i._validationId&&l(new Error("expired")),s.removeFieldError(t,i,n),e()}).catch(function(e){a!==i._validationId&&l(new Error("expired")),s.addFieldError(t,i,n),l(e)})}else e();var u})},addFieldError:function(r,t,n){var a=function(r,t,n){var a=t.nameInMessage,s=e(r.message)?r.message({value:t.value,params:r.params,field:t,fields:n.fields,validation:n,Vue:n.Vue}):r.message;for(var l in s=s.replace(/:name/g,a).replace(/:value/g,t.value),r.params){var o=new RegExp(":params\\["+l+"\\]","g");s=s.replace(o,r.params[l])}var u=s.match(/:fieldName\(.+?\)/g);if(u){var d=!0,c=!1,v=void 0;try{for(var f,h=u[Symbol.iterator]();!(d=(f=h.next()).done);d=!0){var m=f.value,g=m.match(/\((.+)\)/)[1],p=n.fields[g];p||console.warn("vue-data-validator: error when generate error message. Can't found field ".concat(g,". Current field is ").concat(t.name,"."));var y=p?i(p):"";s=s.replace(m,y)}}catch(e){c=!0,v=e}finally{try{d||null==h.return||h.return()}finally{if(c)throw v}}}return s}(r,t,n);if(!t.errors[r.name]){var s={};for(var l in t._resolvedRules)t.errors[l]?s[l]=t.errors[l]:l===r.name&&(s[l]={});t.errors=s}t.errors[r.name]={name:r.name,message:a,field:t},t.valid=!1,n.valid=!1},removeFieldError:function(e,r,t){var i={};for(var n in r.errors)n!==e.name&&(i[n]=r.errors[n]);r.errors=i,r.valid=0===Object.keys(r.errors).length,t.valid=Object.values(t.fields).every(function(e){return e.valid})},removeFieldAllErrors:function(e,r){e.errors={},e.valid=!0,r.valid=Object.values(r.fields).every(function(e){return e.valid})}}});
//# sourceMappingURL=validator.min.js.map
