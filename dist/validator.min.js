/*!
 * vue-data-validator v2.2.14
 * (c) 2017-present phphe <phphe@outlook.com> (https://github.com/phphe)
 * Released under the MIT License.
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):e.vueDataValidator=r()}(this,function(){"use strict";function e(e){return"[object Object]"===Object.prototype.toString.call(e)}function r(e){return"function"==typeof e}function t(r){return null==r||(null!=r.length?0===r.length:!function(e){return"[object Boolean]"===Object.prototype.toString.call(e)}(r)&&(function(e){return"[object Number]"===Object.prototype.toString.call(e)}(r)?isNaN(r):e(r)?0===Object.keys(r).length:void 0))}function i(e){return{storage:e,set:function(e,r,t){null==r?this.storage.removeItem(e):this.storage.setItem(e,JSON.stringify({value:r,expired_at:t&&(new Date).getTime()/1e3+60*t}))},get:function(e){var r=this.storage.getItem(e);if(r){if(!(r=JSON.parse(r)).expired_at||r.expired_at>(new Date).getTime())return r.value;this.storage.removeItem(e)}return null},clear:function(){this.storage.clear()}}}i(window.localStorage),i(window.sessionStorage);function n(e){return e.nameInMessage||e.text&&e.text.toString().toLowerCase()||e.name||"unnamed"}return{rules:{},messages:{},validClass:"has-success",invalidClass:"has-error",validtingClass:"",install:function(e){this.Vue=e,e.validator=e.prototype.$validator=this,e.prototype.$validate=function(r,t){return e.validator.validate(r,t,this)}},validate:function(e,r,t){var i=this;return e.clear&&e.clear(),this.initValidation(e,r,t),this.initFields(e,t),Object.values(r).forEach(function(r){return i.validateField(r,e)}),e},initValidation:function(e,r,t){var i={Vue:this.Vue,fields:r,dirty:!1,valid:!1,validating:!1,isPause:!1,_sensitiveFields:[],vm:t,isSubmitAble:function(){return this.valid&&!this.validating},getValues:function(){return function(e,r){var t={};for(var i in e)t[i]=r(e[i],i,e);return t}(this.fields,function(e){return e.value})},setValues:function(e){for(var r in e)this.fields.hasOwnProperty(r)&&(this.fields[r].value=e[r]);return this},setDirty:function(e){return this.dirty=e,Object.values(this.fields).forEach(function(r){r.dirty=e}),this},check:function(){var e=this;return new Promise(function(r,t){return e.validating&&(e._checkResolves||(e._checkResolves=[])),(e.validating?new Promise(function(r,t){e._checkResolves.push(r)}):Promise.resolve()).then(function(){e.valid?r(e.getValues()):(e.setDirty(!0),t(new Error("invalid")))})})},unwatch:function(){return Object.values(this.fields).forEach(function(e){e.watcher&&e.watcher.unwatch&&e.watcher.unwatch()}),this},pause:function(){return this.isPause=!0,this},continue:function(){return this.isPause=!1,this},clear:function(){return this.unwatch(),this.setDirty(!1),Object.values(this.fields).forEach(function(e){e.required=!1}),this},revalidate:function(){return t.$validate(this,this.fields)},getFirstError:function(){var e=Object.values(this.fields).find(function(e){return Object.values(e.errors)[0]});return e&&Object.values(e.errors)[0]},getErrors:function(){var e=[];return Object.values(this.fields).forEach(function(r){Object.values(r.errors).forEach(function(r){e.push(r)})}),e}};for(var n in i)t.$set(e,n,i[n])},initFields:function(r,t){var i=this,a=function(a){var s=r.fields[a];if(s.name){if(s.name!==a)throw Error("The field name must be same with its key.")}else t.$set(s,"name",a);s.nameInMessage||(s.nameInMessage=n(s)),t.$set(s,"value",void 0!==s.value?s.value:null),t.$set(s,"dirty",!1),t.$set(s,"valid",!1),t.$set(s,"errors",{}),t.$set(s,"required",!1),t.$set(s,"validating",!1),t.$set(s,"_resolvedRules",i.resolveRules(s)),t.$set(s,"isValidationErrorsVisible",function(e){e||(e=[s]);var r=!0,t=!1,i=void 0;try{for(var n,a=e[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){var l=n.value;if(l.rules&&l.dirty&&!s.validating&&!s.valid)return!0}}catch(e){t=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(t)throw i}}return!1}),t.$set(s,"getValidationClass",function(e){var r;e||(e=[s]);var t=!0,n=!1,a=void 0;try{for(var l,o=e[Symbol.iterator]();!(t=(l=o.next()).done);t=!0){var u=l.value;if(u.rules&&u.dirty){if(r=!0,s.validating)return i.validatingClass;if(!s.valid)return i.invalidClass}}}catch(e){n=!0,a=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}return r?i.validClass:null}),Object.values(s._resolvedRules).find(function(e){return e.sensitive})&&r._sensitiveFields.push(s);var l={getValue:function(){return s.value},handler:function(e){r.isPause||(s._ignoreDirtyOnce?s._ignoreDirtyOnce=!1:(s.dirty=!0,r.dirty=!0),i.validateField(s,r),r._sensitiveFields.filter(function(e){return e!==s}).forEach(function(e){i.validateField(e,r)}))}},o=void 0;o=null!==s.deep?s.deep:e(s.value)||function(e){return"[object Array]"===Object.prototype.toString.call(e)}(s.value),l.unwatch=t.$watch(l.getValue,l.handler,{deep:o}),t.$set(s,"watcher",l)};for(var s in r.fields)a(s)},resolveRules:function(e){var t={};if(e.rules){var i=e.rules.split("|");for(var n in i){var a=i[n].split(":"),s=a[1]?a[1].split(","):[],l=a[0];e.ruleParams&&e.ruleParams[l]&&(s=s.concat(e.ruleParams[l]));var o=e.customRules&&e.customRules[l]||this.rules[l];if(r(o)&&(o={handler:o}),null==o)throw Error("Rule '".concat(l,"' of field '").concat(e.name,"' is not found."));t[l]={name:l,params:s,required:o.required,sensitive:o.sensitive,handler:o.handler,message:e.messages&&e.messages[l]||this.messages&&this.messages[l]||"No error message for :name."}}}return t},validateField:function(e,r){var t=this,i={};e._validationId=i,r.validating=!0,e.validating=!0,this.removeFieldAllErrors(e,r);for(var n=Object.values(e._resolvedRules),a=Promise.resolve(!0),s=function(){var s=n[l];a=a.then(function(){return t.validateRule(s,e,r,i)})},l=0;l<n.length;l++)s();a.then(function(){return!0}).catch(function(e){return"expired"!==e.message}).then(function(t){t&&(e._validationId=null,e.validating=!1,r.validating=Object.values(r.fields).some(function(e){return e.validating}),r.validating||r._checkResolves&&(r._checkResolves.forEach(function(e){e()}),r._checkResolves=null))})},validateRule:function(e,i,n,a){var s=this;return null!=e.required&&(i.required=r(e.required)?e.required({value:i.value,params:e.params,field:i,fields:n.fields,validation:n,Vue:n.Vue}):e.required),new Promise(function(r,l){if(i.required||!t(i.value)){var o=e.handler({value:i.value,params:e.params,field:i,fields:n.fields,validation:n,Vue:n.Vue});u=o,"[object Promise]"!==Object.prototype.toString.call(u)&&(o=o?Promise.resolve():Promise.reject(new Error("invalid"))),o.then(function(){a!==i._validationId&&l(new Error("expired")),s.removeFieldError(e,i,n),r()}).catch(function(r){a!==i._validationId&&l(new Error("expired")),s.addFieldError(e,i,n),l(r)})}else r();var u})},addFieldError:function(e,t,i){var a=function(e,t,i){var a=t.nameInMessage,s=r(e.message)?e.message({value:t.value,params:e.params,field:t,fields:i.fields,validation:i,Vue:i.Vue}):e.message;for(var l in s=s.replace(/:name/g,a).replace(/:value/g,t.value),e.params){var o=new RegExp(":params\\["+l+"\\]","g");s=s.replace(o,e.params[l])}var u=s.match(/:fieldName\(.+?\)/g);if(u){var c=!0,d=!1,v=void 0;try{for(var f,h=u[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var m=f.value,g=m.match(/\((.+)\)/)[1],p=i.fields[g];p||console.warn("vue-data-validator: error when generate error message. Can't found field ".concat(g,". Current field is ").concat(t.name,"."));var y=p?n(p):"";s=s.replace(m,y)}}catch(e){d=!0,v=e}finally{try{c||null==h.return||h.return()}finally{if(d)throw v}}}return s}(e,t,i);if(!t.errors[e.name]){var s={};for(var l in t._resolvedRules)t.errors[l]?s[l]=t.errors[l]:l===e.name&&(s[l]={});t.errors=s}t.errors[e.name]={name:e.name,message:a,field:t},t.valid=!1,i.valid=!1},removeFieldError:function(e,r,t){var i={};for(var n in r.errors)n!==e.name&&(i[n]=r.errors[n]);r.errors=i,r.valid=0===Object.keys(r.errors).length,t.valid=Object.values(t.fields).every(function(e){return e.valid})},removeFieldAllErrors:function(e,r){e.errors={},e.valid=!0,r.valid=Object.values(r.fields).every(function(e){return e.valid})}}});
//# sourceMappingURL=validator.min.js.map
