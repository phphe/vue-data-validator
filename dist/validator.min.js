/*!
 * vue-data-validator v2.0.4
 * phphe
 * https://github.com/phphe/vue-data-validator.git
 * Released under the MIT License.
 */

!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e.vueDataValidatorValidator=e.vueDataValidatorValidator||{},e.vueDataValidatorValidator.js=r())}(this,function(){"use strict";function e(e){return void 0!==e}function r(e){return"[object Boolean]"===Object.prototype.toString.call(e)}function t(e){return"[object Number]"===Object.prototype.toString.call(e)}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(e){return"function"==typeof e}function a(e){return"[object Promise]"===Object.prototype.toString.call(e)}function s(e){return null==e||(null!=e.length?0===e.length:!r(e)&&(t(e)?isNaN(e):i(e)?0===Object.keys(e).length:void 0))}function l(e,r){var t={};for(var i in e)t[i]=r(e[i],i,e);return t}function u(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function i(n,a){try{var s=r[n](a),l=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(l).then(function(e){i("next",e)},function(e){i("throw",e)});e(l)}return i("next")})}}return{rules:{},messages:{},validClass:"has-success",invalidClass:"has-error",validtingClass:"",install:function(e){e.validator=e.prototype.$validator=this,e.prototype.$validate=function(r,t){return e.validator.validate(r,t,this)}},validate:function(e,r,t){var i=this;return e.clear&&e.clear(),this.initValidation(e,r,t),this.initFields(e,t),Object.values(r).forEach(function(r){return i.validateField(r,e)}),e},initValidation:function(e,r,t){var i={fields:r,dirty:!1,valid:!1,validating:!1,_sensitiveFields:[],vm:t,isSubmitAble:function(){return this.valid&&!this.validating},getValues:function(){return l(this.fields,function(e){return e.value})},setValues:function(e){for(var r in e)this.fields.hasOwnProperty(r)&&(this.fields[r].value=e[r]);return this},setDirty:function(e){return this.dirty=e,Object.values(this.fields).forEach(function(r){r.dirty=e}),this},check:function(){var e=this;return new Promise(function(r,t){e.validating?t(new Error("Data is being validated")):e.valid?r(e.getValues()):(e.setDirty(!0),t(new Error("Data is invalid")))})},unwatch:function(){return Object.values(this.fields).forEach(function(e){e.watcher&&e.watcher.unwatch&&e.watcher.unwatch()}),this},pause:function(){return this.unwatch(),this},continue:function(){var e=this;return this.unwatch(),Object.values(this.fields).forEach(function(r){var t=r.watcher;t.unwatch=e.vm.$watch(t.getValue,t.handler)}),this},clear:function(){return this.unwatch(),this.setDirty(!1),Object.values(this.fields).forEach(function(e){e.required=!1}),this}};for(var n in i)t.$set(e,n,i[n])},initFields:function(r,t){var i=this;for(var n in r.fields)!function(n){var a=r.fields[n];if(a.name){if(a.name!==n)throw Error("The field name must be same with its key.")}else t.$set(a,"name",n);e(a.value)||t.$set(a,"value",null),t.$set(a,"dirty",!1),t.$set(a,"valid",!1),t.$set(a,"errors",{}),t.$set(a,"required",!1),t.$set(a,"validating",!1),t.$set(a,"_resolvedRules",i.resolveRules(a)),t.$set(a,"isValidationErrorsVisible",function(){return a.rules&&!a.validating&&a.dirty&&!a.valid}),t.$set(a,"getValidationClass",function(){return a.rules&&a.dirty?a.validating?i.validatingClass:a.valid?i.validClass:i.invalidClass:null}),Object.values(a._resolvedRules).find(function(e){return e.sensitive})&&r._sensitiveFields.push(a);var s={getValue:function(){return a.value},handler:function(e){i.validateField(a,r),a.dirty=!0,r.dirty=!0,r._sensitiveFields.filter(function(e){return e!==a}).forEach(function(e){i.validateField(e,r)})}};s.unwatch=t.$watch(s.getValue,s.handler),t.$set(a,"watcher",s)}(n)},resolveRules:function(e){var r={};if(e.rules){var t=e.rules.split("|");for(var i in t){var a=t[i].split(":"),s=a[1]?a[1].split(","):[],l=a[0];e.ruleParams&&e.ruleParams[l]&&(s=s.concat(e.ruleParams[l]));var u=e.customRules&&e.customRules[l]||this.rules[l];if(n(u)&&(u={handler:u}),null==u)throw Error("Rule '"+l+"' of field '"+e.name+"' is not found.");r[l]={name:l,params:s,required:u.required,sensitive:u.sensitive,handler:u.handler,message:e.messages&&e.messages[l]||this.messages&&this.messages[l]||"No error message for :name."}}}return r},validateField:function(e,r){var t=this,i={};e._validationId=i,r.validating=!0,e.validating=!0,this.removeFieldAllErrors(e,r);var n=Object.values(e._resolvedRules);(function(){var a=u(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:a.t0=regeneratorRuntime.keys(n);case 1:if((a.t1=a.t0()).done){a.next=7;break}return s=a.t1.value,a.next=5,t.validateRule(s,e,r,i);case 5:a.next=1;break;case 7:case"end":return a.stop()}},a,t)}));return function(){return a.apply(this,arguments)}})()().then(function(){return!0}).catch(function(e){return"invalid"===e.message}).then(function(){e._validationId=null,e.validating=!1,r.validating=Object.values(r.fields).some(function(e){return e.validating})})},validateRule:function(e,r,t,i){var l=this;return null!=e.required&&(r.required=n(e.required)?e.required(r.value,e.params,r,t.fields,t,t.vm.constructor):e.required),new Promise(function(n,u){if(r.required||!s(r.value)){var o=e.handler(r.value,e.params,r,t.fields,t,t.vm.constructor);a(o)||(o=o?Promise.resolve():Promise.reject(new Error("invalid. field:"+r.name+", rule:"+e.name))),o.then(function(){i!==r._validationId&&u(new Error("expired")),l.removeFieldError(e,r,t),n()}).catch(function(){i!==r._validationId&&u(new Error("expired")),l.addFieldError(e,r,t),u(new Error("invalid"))})}else n()})},addFieldError:function(e,r,t){var i=r.nameInMessage||r.text&&r.text.toString().toLowerCase()||r.name||"unnamed",n=e.message.replace(/:name/g,i).replace(/:value/g,r.value);for(var a in e.params){var s=new RegExp(":params\\["+a+"\\]","g");n=n.replace(s,e.params[a])}if(!r.errors[e.name]){var l={};for(var u in r._resolvedRules)r.errors[u]?l[u]=r.errors[u]:u===e.name&&(l[u]={});r.errors=l}r.errors[e.name]={name:e.name,message:n},r.valid=!1,t.valid=!1},removeFieldError:function(e,r,t){var i={};for(var n in r.errors)n!==e.name&&(i[n]=r.errors[n]);r.errors=i,r.valid=0===Object.keys(r.errors).length,t.valid=Object.values(t.fields).every(function(e){return e.valid})},removeFieldAllErrors:function(e,r){e.errors={},e.valid=!0,r.valid=Object.values(r.fields).every(function(e){return e.valid})}}});
//# sourceMappingURL=validator.min.js.map