!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.vueDataValidatorVueDataValidator=e.vueDataValidatorVueDataValidator||{},e.vueDataValidatorVueDataValidator.js=e.vueDataValidatorVueDataValidator.js||{}))}(this,function(e){"use strict";function t(e){return void 0!==e}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function a(e){return"[object Boolean]"===Object.prototype.toString.call(e)}function r(e){return"[object Number]"===Object.prototype.toString.call(e)}function i(e){var t=parseFloat(e);return!isNaN(t)&&r(t)}function s(e){return"[object String]"===Object.prototype.toString.call(e)}function u(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"function"==typeof e}function l(e){return"[object Promise]"===Object.prototype.toString.call(e)}function d(e){return null==e||(null!=e.length?0===e.length:!a(e)&&(r(e)?isNaN(e):u(e)?0===Object.keys(e).length:void 0))}function c(e,t){var n={};for(var a in e)n[a]=t(e[a],a,e);return n}var m=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function a(r,i){try{var s=t[r](i),u=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(u).then(function(e){a("next",e)},function(e){a("throw",e)});e(u)}return a("next")})}},f={rules:{},messages:{},validClass:"has-success",invalidClass:"has-error",validtingClass:"",install:function(e){e.validator=e.prototype.$validator=this,e.prototype.$validate=function(t,n){return e.validator.validate(t,n,this)}},validate:function(e,t,n){var a=this;return e.clear&&e.clear(),this.initValidation(e,t,n),this.initFields(e,n),Object.values(t).forEach(function(t){return a.validateField(t,e)}),e},initValidation:function(e,t,n){var a={fields:t,dirty:!1,valid:!1,validating:!1,_sensitiveFields:[],vm:n,isSubmitAble:function(){return this.valid&&!this.validating},getValues:function(){return c(this.fields,function(e){return e.value})},setValues:function(e){for(var t in e)this.fields.hasOwnProperty(t)&&(this.fields[t].value=e[t]);return this},setDirty:function(e){return this.dirty=e,Object.values(this.fields).forEach(function(t){t.dirty=e}),this},check:function(){var e=this;return new Promise(function(t,n){e.validating?n(new Error("Data is being validated")):e.valid?t(e.getValues()):(e.setDirty(!0),n(new Error("Data is invalid")))})},unwatch:function(){return Object.values(this.fields).forEach(function(e){e.watcher&&e.watcher.unwatch&&e.watcher.unwatch()}),this},pause:function(){return this.unwatch(),this},continue:function(){var e=this;return this.unwatch(),Object.values(this.fields).forEach(function(t){var n=t.watcher;n.unwatch=e.vm.$watch(n.getValue,n.handler)}),this},clear:function(){return this.unwatch(),this.setDirty(!1),Object.values(this.fields).forEach(function(e){e.required=!1}),this}};for(var r in a)n.$set(e,r,a[r])},initFields:function(e,n){var a=this;for(var r in e.fields)!function(r){var i=e.fields[r];if(i.name){if(i.name!==r)throw Error("The field name must be same with its key.")}else n.$set(i,"name",r);t(i.value)||n.$set(i,"value",null),n.$set(i,"dirty",!1),n.$set(i,"valid",!1),n.$set(i,"errors",{}),n.$set(i,"required",!1),n.$set(i,"validating",!1),n.$set(i,"_resolvedRules",a.resolveRules(i)),n.$set(i,"isValidationErrorsVisible",function(){return i.rules&&!i.validating&&i.dirty&&!i.valid}),n.$set(i,"getValidationClass",function(){return i.rules&&i.dirty?i.validating?a.validatingClass:i.valid?a.validClass:a.invalidClass:null}),Object.values(i._resolvedRules).find(function(e){return e.sensitive})&&e._sensitiveFields.push(i);var s={getValue:function(){return i.value},handler:function(t){a.validateField(i,e),i.dirty=!0,e.dirty=!0,e._sensitiveFields.filter(function(e){return e!==i}).forEach(function(t){a.validateField(t,e)})}};s.unwatch=n.$watch(s.getValue,s.handler),n.$set(i,"watcher",s)}(r)},resolveRules:function(e){var t={};if(e.rules){var n=e.rules.split("|");for(var a in n){var r=n[a].split(":"),i=r[1]?r[1].split(","):[],s=r[0];e.ruleParams&&e.ruleParams[s]&&(i=i.concat(e.ruleParams[s]));var u=e.customRules&&e.customRules[s]||this.rules[s];if(o(u)&&(u={handler:u}),null==u)throw Error("Rule '"+s+"' of field '"+e.name+"' is not found.");t[s]={name:s,params:i,required:u.required,sensitive:u.sensitive,handler:u.handler,message:e.messages&&e.messages[s]||this.messages&&this.messages[s]||"No error message for :name."}}}return t},validateField:function(e,t){var n=this,a={};e._validationId=a,t.validating=!0,e.validating=!0,this.removeFieldAllErrors(e,t);var r=Object.values(e._resolvedRules);(function(){var i=m(regeneratorRuntime.mark(function i(){var s;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:i.t0=regeneratorRuntime.keys(r);case 1:if((i.t1=i.t0()).done){i.next=7;break}return s=i.t1.value,i.next=5,n.validateRule(s,e,t,a);case 5:i.next=1;break;case 7:case"end":return i.stop()}},i,n)}));return function(){return i.apply(this,arguments)}})()().then(function(){return!0}).catch(function(e){return"invalid"===e.message}).then(function(){e._validationId=null,e.validating=!1,t.validating=Object.values(t.fields).some(function(e){return e.validating})})},validateRule:function(e,t,n,a){var r=this;return null!=e.required&&(t.required=o(e.required)?e.required(t.value,e.params,t,n.fields,n,n.vm.constructor):e.required),new Promise(function(i,s){if(t.required||!d(t.value)){var u=e.handler(t.value,e.params,t,n.fields,n,n.vm.constructor);l(u)||(u=u?Promise.resolve():Promise.reject(new Error("invalid. field:"+t.name+", rule:"+e.name))),u.then(function(){a!==t._validationId&&s(new Error("expired")),r.removeFieldError(e,t,n),i()}).catch(function(){a!==t._validationId&&s(new Error("expired")),r.addFieldError(e,t,n),s(new Error("invalid"))})}else i()})},addFieldError:function(e,t,n){var a=t.nameInMessage||t.text&&t.text.toString().toLowerCase()||t.name||"unnamed",r=e.message.replace(/:name/g,a).replace(/:value/g,t.value);for(var i in e.params){var s=new RegExp(":params\\["+i+"\\]","g");r=r.replace(s,e.params[i])}if(!t.errors[e.name]){var u={};for(var o in t._resolvedRules)t.errors[o]?u[o]=t.errors[o]:o===e.name&&(u[o]={});t.errors=u}t.errors[e.name]={name:e.name,message:r},t.valid=!1,n.valid=!1},removeFieldError:function(e,t,n){var a={};for(var r in t.errors)r!==e.name&&(a[r]=t.errors[r]);t.errors=a,t.valid=0===Object.keys(t.errors).length,n.valid=Object.values(n.fields).every(function(e){return e.valid})},removeFieldAllErrors:function(e,t){e.errors={},e.valid=!0,t.valid=Object.values(t.fields).every(function(e){return e.valid})}},h={accepted:function(e){return"yes"===e||"on"===e||e===!0||1===e||"1"===e},alpha:function(e){return/^[a-zA-Z]+$/.test(e)},alphaDash:function(e){return/^[\w-]+$/.test(e)},alphaNum:function(e){return/^[\w]+$/.test(e)},between:function(e,t){return t[0]<=e&&t[1]<=e},boolean:function(e){return[!0,!1,1,0,"1","0"].includes(e)},date:function(e){return/^\d\d\d\d-\d\d?-\d\d?$/.test(e)},datetime:function(e){return/^\d\d\d\d-\d\d?-\d\d? \d\d?:\d\d?:\d\d?$/.test(e)},different:{handler:function(e,t,n,a){return e!==a[t[0]].value},sensitive:!0},email:function(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},in:function(e,t){return(n(t[0])?t[0]:t).indexOf(e)>-1},integer:function(e){return/^-?[1-9]\d*$/.test(e)},length:function(e,t){return(e||"").toString().length===parseInt(t[0])},lengthBetween:function(e,t){var n=(e||"").toString().length;return t[0]<=n&&n<=t[1]},max:function(e,t){return e<=t[0]},maxLength:function(e,t){return(e||"").toString().length<=t[0]},min:function(e,t){return e>=t[0]},minLength:function(e,t){return(e||"").toString().length>=t[0]},notIn:function(e,t){return(n(t[0])?t[0]:t).indexOf(e)===-1},numeric:function(e){return i(e)},required:{handler:function(e,t,n){return!d(e)},required:!0},requiredWith:{handler:function(e){return!d(e)},sensitive:!0,required:function(e,t,n,a){return!d(a[t[0]].value)}},same:{handler:function(e,t,n,a){return e===a[t[0]].value},sensitive:!0},size:function(e,t){return(e||"").toString().length===parseInt(t[0])},string:function(e){return s(e)},remoteCheck:function(e,t,a,r,i,s){if(void 0!==t[1]){if((n(t[1])?t[1]:[t[1]]).indexOf(e)>-1)return!0}return new Promise(function(n,a){var r=t[0].replace(/:value/g,e);return s.http.get(r).then(function(e){e.data===!0||1===e.data||"true"===e.data?n(e.data,e.status,e):a(e.data,e.status,e)}).catch(function(e){a(e.data,e.status,e)})})},remoteNotExisted:function(e,t,n,a,r,i){return this.remoteCheck(e,t,n,a,r,i)}},v={accepted:"The :name must be accepted.",alpha:"The :name may only contain letters.",alphaDash:"The :name may only contain letters, numbers, and dashes.",alphaNum:"The :name may only contain letters and numbers.",between:"The :name must be between :params[0] and :params[1].",boolean:"The :name field must be true or false.",date:"The :name is not a valid date.",datetime:"The :name is not a valid datetime.",different:"The :name and :params[0] must be different.",email:"The :name must be a valid email address.",in:"The selected :name is invalid.",integer:"The :name must be an integer.",length:"The :name must be :params[0] characters.",lengthBetween:"The :name must be between :params[0] and :params[1] characters.",max:"The :name may not be greater than :params[0].",maxLength:"The :name may not be greater than :params[0] characters.",min:"The :name must be at least :params[0].",minLength:"The :name must be at least :params[0] characters.",notIn:"The selected :name is invalid.",numeric:"The :name must be a number.",required:"The :name field is required.",requiredWith:"The :name field is required when :params[1] is present.",same:"The :name and :params[1] must match.",size:"The :name must be :params[0] characters.",string:"The :name must be a string.",remoteCheck:"The :name is invalid.",remoteNotExisted:"The :name already exists."},p={accepted:"您必须同意:name才能继续。",alpha:":name仅能包含字母。",alphaDash:":name仅能包含字母，数字，破折号和下划线。",alphaNum:":name仅能包含字母和数字。",between:":name必须在:params[0]和:params[1]之间。",boolean:":name必须为true或false。",date:":name必须是一个正确格式的日期。",datetime:":name必须是一个正确格式的日期时间。",different:":name不能与:params[0]相同。",email:":name不是一个正确的邮箱。",in:"选择的:name不可用。",integer:":name必须是整数。",length:":name必须包含:params[0]个字符。",lengthBetween:":name的长度须在:params[0]和:params[1]之间。",max:":name不能超过:params[0]。",maxLength:":name的长度不能超过:params[0]。",min:":name不能低于:params[0]。",minLength:":name的长度不能低于:params[0]。",notIn:"选择的:name不可用。",numeric:":name不是一个正确的数字。",required:"请填写:name。",requiredWith:"请填写:name。当:params[1]不为空时，:name必填。",same:":name必须与:params[1]相同。",size:":name必须有:params[0]个字符。",string:":name必须是字符串。",remoteCheck:":name错误。",remoteNotExisted:":name已存在。"};e.validator=f,e.rules=h,e.enMessages=v,e.zhCNMessages=p,Object.defineProperty(e,"__esModule",{value:!0})});
